<!DOCTYPE html>
<html lang="zh-Hant" data-bs-theme="auto">
<head>
    <meta charset="UTF-8">
    <title>工具整合頁</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        iframe {
            width: 100%;
            height: 800px;
            border: none;
        }
        .tab-content {
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 0.375rem 0.375rem;
        }
        [data-bs-theme="light"] .tab-content { background-color: #ffffff; color: #212529; }
        [data-bs-theme="dark"]  .tab-content { background-color: #1e1e1e; color: #f8f9fa; }
        .theme-toggle { position: absolute; top: 1rem; right: 1rem; }
    </style>
</head>
<body>
<div class="container py-4 position-relative">

    <!-- 主題切換按鈕：文字與外觀會依主題改變 -->
    <button class="btn theme-toggle" id="toggleThemeBtn">切換主題</button>

    <ul class="nav nav-tabs" id="toolTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active"
                    id="tab1-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#tab1"
                    type="button" role="tab"
                    aria-controls="tab1"
                    aria-selected="true">WorkTab</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link"
                    id="tab2-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#tab2"
                    type="button" role="tab"
                    aria-controls="tab2"
                    aria-selected="false">JSON ➜ map()</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link"
                    id="tab3-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#tab3"
                    type="button" role="tab"
                    aria-controls="tab3"
                    aria-selected="false">銀行對應工具</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link"
                    id="tab4-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#tab4"
                    type="button" role="tab"
                    aria-controls="tab4"
                    aria-selected="false">格式轉換工具</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link"
                    id="tab5-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#tab5"
                    type="button" role="tab"
                    aria-controls="tab5"
                    aria-selected="false">JSON 資料格式化工具</button>
        </li>
    </ul>

    <div class="tab-content mt-3" id="toolTabsContent">
        <div class="tab-pane fade show active" id="tab1" role="tabpanel" aria-labelledby="tab1-tab">
            <iframe src="ToolPage/WorkWebPage.html"></iframe>
        </div>
        <div class="tab-pane fade" id="tab2" role="tabpanel" aria-labelledby="tab2-tab">
            <iframe src="ToolPage/JSON2map.html"></iframe>
        </div>
        <div class="tab-pane fade" id="tab3" role="tabpanel" aria-labelledby="tab3-tab">
            <iframe src="ToolPage/Bank-Tool.html"></iframe>
        </div>
        <div class="tab-pane fade" id="tab4" role="tabpanel" aria-labelledby="tab4-tab">
            <iframe src="ToolPage/DataFormat.html"></iframe>
        </div>
        <div class="tab-pane fade" id="tab5" role="tabpanel" aria-labelledby="tab5-tab">
            <iframe src="ToolPage/JSON_Format.html"></iframe>
        </div>
    </div>

</div>

<script>
    // ===== 主題切換與同步 =====
    const htmlEl = document.documentElement;
    const toggleBtn = document.getElementById('toggleThemeBtn');

    function getCurrentTheme() {
        return htmlEl.getAttribute('data-bs-theme') || 'light';
    }

    // 依主題更新按鈕外觀與文字
    function updateToggleButton(theme) {
        if (theme === 'dark') {
            toggleBtn.textContent = '深色模式';
            toggleBtn.className = 'btn btn-light theme-toggle';
            toggleBtn.style.color = '#000';
        } else {
            toggleBtn.textContent = '淺色模式';
            toggleBtn.className = 'btn btn-dark theme-toggle';
            toggleBtn.style.color = '#fff';
        }
    }

    // 初始化主題：localStorage 或系統偏好
    function initializeTheme() {
        const savedTheme = localStorage.getItem('theme');
        let theme;
        if (savedTheme) {
            theme = savedTheme;
        } else {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            theme = prefersDark ? 'dark' : 'light';
        }
        htmlEl.setAttribute('data-bs-theme', theme);
        updateToggleButton(theme);
    }

    // 將主題傳送給所有 iframe
    function sendThemeToIframes(theme) {
        document.querySelectorAll('iframe').forEach(iframe => {
            iframe.contentWindow?.postMessage({ theme }, '*');
        });
    }

    // 切換主題
    function toggleTheme() {
        const current = getCurrentTheme();
        const next = current === 'dark' ? 'light' : 'dark';
        htmlEl.setAttribute('data-bs-theme', next);
        localStorage.setItem('theme', next);
        updateToggleButton(next);
        sendThemeToIframes(next);
    }

    // iframe 要主題 → 回傳
    function handleMessageFromIframe(event) {
        if (event.data?.ask === 'theme') {
            const currentTheme = getCurrentTheme();
            event.source?.postMessage({ theme: currentTheme }, '*');
        }
    }

    // 初始化
    function setup() {
        initializeTheme();
        sendThemeToIframes(getCurrentTheme());
        toggleBtn?.addEventListener('click', toggleTheme);
        window.addEventListener('message', handleMessageFromIframe);

        // 若使用者在其他分頁改了主題（localStorage），這裡也同步
        window.addEventListener('storage', (e) => {
            if (e.key === 'theme' && e.newValue) {
                htmlEl.setAttribute('data-bs-theme', e.newValue);
                updateToggleButton(e.newValue);
                sendThemeToIframes(e.newValue);
            }
        });
    }

    setup();
</script>
</body>
</html>
